{% extends "base.html" %}

{% block title %}{{ '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•' if student else '‡πÄ‡∏û‡∏¥‡πà‡∏°' }}‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô - Basketball Academy{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb mb-0">
        <li class="breadcrumb-item"><a href="{{ url_for('index') }}" class="text-decoration-none">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a></li>
        {% if student %}
        <li class="breadcrumb-item"><a href="{{ url_for('student_detail', student_id=student.id) }}" class="text-decoration-none">{{ student.firstName }} {{ student.lastName }}</a></li>
        {% endif %}
        <li class="breadcrumb-item active">{{ '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•' if student else '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô' }}</li>
    </ol>
</nav>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0 d-flex align-items-center gap-2">
        <i class="fas fa-{{ 'user-edit text-warning' if student else 'user-plus text-success' }}"></i>
        <span>{{ '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô' if student else '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà' }}</span>
    </h1>
</div>

<form method="POST">
    <div class="row g-4">
        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
        <div class="col-12 col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0 fw-semibold">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-12 col-md-4">
                            <label class="form-label fw-medium">‡∏ä‡∏∑‡πà‡∏≠ <span class="text-danger">*</span></label>
                            <input type="text" name="firstName" class="form-control" required
                                   value="{{ student.firstName if student else '' }}">
                        </div>
                        <div class="col-12 col-md-4">
                            <label class="form-label fw-medium">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span class="text-danger">*</span></label>
                            <input type="text" name="lastName" class="form-control" required
                                   value="{{ student.lastName if student else '' }}">
                        </div>
                        <div class="col-12 col-md-4">
                            <label class="form-label fw-medium">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô <span class="text-danger">*</span></label>
                            <input type="text" name="nickname" class="form-control" required
                                   value="{{ student.nickname if student else '' }}">
                        </div>

                        <div class="col-12 col-md-4">
                            <label class="form-label fw-medium">‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î <span class="text-danger">*</span></label>
                            <input type="date" name="birthDate" class="form-control" required
                                   value="{{ student.birthDate if student else '' }}">
                        </div>
                        <div class="col-12 col-md-4">
                            <label class="form-label fw-medium">‡πÄ‡∏û‡∏® <span class="text-danger">*</span></label>
                            <select name="gender" class="form-select" required>
                                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏® --</option>
                                <option value="‡∏ä‡∏≤‡∏¢" {% if student and student.gender == '‡∏ä‡∏≤‡∏¢' %}selected{% endif %}>‡∏ä‡∏≤‡∏¢</option>
                                <option value="‡∏´‡∏ç‡∏¥‡∏á" {% if student and student.gender == '‡∏´‡∏ç‡∏¥‡∏á' %}selected{% endif %}>‡∏´‡∏ç‡∏¥‡∏á</option>
                            </select>
                        </div>
                        <div class="col-12 col-md-4">
                            <label class="form-label fw-medium">‡∏™‡∏±‡∏ç‡∏ä‡∏≤‡∏ï‡∏¥</label>
                            <input type="text" name="nationality" class="form-control"
                                   value="{{ student.nationality if student else '‡πÑ‡∏ó‡∏¢' }}">
                        </div>

                        <div class="col-12 col-md-6">
                            <label class="form-label fw-medium">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô <span class="text-danger">*</span></label>
                            <input type="text" name="school" class="form-control" required
                                   placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤‡∏ò‡∏¥‡∏ï"
                                   value="{{ student.school if student else '' }}">
                        </div>
                        <div class="col-12 col-md-3">
                            <label class="form-label fw-medium">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô <span class="text-danger">*</span></label>
                            <select name="grade" class="form-select" required>
                                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô --</option>
                                <optgroup label="‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•">
                                    <option value="‡∏≠.1" {% if student and student.grade == '‡∏≠.1' %}selected{% endif %}>‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 1</option>
                                    <option value="‡∏≠.2" {% if student and student.grade == '‡∏≠.2' %}selected{% endif %}>‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 2</option>
                                    <option value="‡∏≠.3" {% if student and student.grade == '‡∏≠.3' %}selected{% endif %}>‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 3</option>
                                </optgroup>
                                <optgroup label="‡∏õ‡∏£‡∏∞‡∏ñ‡∏°">
                                    <option value="‡∏õ.1" {% if student and student.grade == '‡∏õ.1' %}selected{% endif %}>‡∏õ‡∏£‡∏∞‡∏ñ‡∏° 1</option>
                                    <option value="‡∏õ.2" {% if student and student.grade == '‡∏õ.2' %}selected{% endif %}>‡∏õ‡∏£‡∏∞‡∏ñ‡∏° 2</option>
                                    <option value="‡∏õ.3" {% if student and student.grade == '‡∏õ.3' %}selected{% endif %}>‡∏õ‡∏£‡∏∞‡∏ñ‡∏° 3</option>
                                    <option value="‡∏õ.4" {% if student and student.grade == '‡∏õ.4' %}selected{% endif %}>‡∏õ‡∏£‡∏∞‡∏ñ‡∏° 4</option>
                                    <option value="‡∏õ.5" {% if student and student.grade == '‡∏õ.5' %}selected{% endif %}>‡∏õ‡∏£‡∏∞‡∏ñ‡∏° 5</option>
                                    <option value="‡∏õ.6" {% if student and student.grade == '‡∏õ.6' %}selected{% endif %}>‡∏õ‡∏£‡∏∞‡∏ñ‡∏° 6</option>
                                </optgroup>
                                <optgroup label="‡∏°‡∏±‡∏ò‡∏¢‡∏°">
                                    <option value="‡∏°.1" {% if student and student.grade == '‡∏°.1' %}selected{% endif %}>‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏ï‡πâ‡∏ô 1</option>
                                    <option value="‡∏°.2" {% if student and student.grade == '‡∏°.2' %}selected{% endif %}>‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏ï‡πâ‡∏ô 2</option>
                                    <option value="‡∏°.3" {% if student and student.grade == '‡∏°.3' %}selected{% endif %}>‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏ï‡πâ‡∏ô 3</option>
                                    <option value="‡∏°.4" {% if student and student.grade == '‡∏°.4' %}selected{% endif %}>‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏õ‡∏•‡∏≤‡∏¢ 4</option>
                                    <option value="‡∏°.5" {% if student and student.grade == '‡∏°.5' %}selected{% endif %}>‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏õ‡∏•‡∏≤‡∏¢ 5</option>
                                    <option value="‡∏°.6" {% if student and student.grade == '‡∏°.6' %}selected{% endif %}>‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏õ‡∏•‡∏≤‡∏¢ 6</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="col-12 col-md-3">
                            <label class="form-label fw-medium">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label>
                            <input type="tel" name="phone" class="form-control"
                                   placeholder="0812345678"
                                   value="{{ student.phone if student else '' }}">
                        </div>

                        <div class="col-12">
                            <label class="form-label fw-medium">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏û‡πâ‡∏¢‡∏≤/‡∏≠‡∏≤‡∏´‡∏≤‡∏£</label>
                            <textarea name="allergies" class="form-control" rows="2"
                                      placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ‡∏¢‡∏≤ ‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏¥‡πà‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)">{{ student.allergies if student else '' }}</textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0 fw-semibold">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label fw-medium">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</label>
                        <select name="parentId" class="form-select">
                            <option value="">-- ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ / ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á --</option>
                            {% for parent in parents %}
                            <option value="{{ parent.id }}" {% if student and student.parentId == parent.id %}selected{% endif %}>
                                {{ 'üë® ‡∏Ñ‡∏∏‡∏ì‡∏û‡πà‡∏≠' if parent.type == 'father' else 'üë© ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏°‡πà' }} - {{ parent.name }}
                                ({{ parent.phone }})
                            </option>
                            {% endfor %}
                        </select>
                        <small class="text-muted">
                            ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á <a href="{{ url_for('add_parent') }}" target="_blank" class="text-decoration-none">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</a>
                        </small>
                    </div>
                </div>
            </div>

            {% if not student %}
            <!-- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà) -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0 fw-semibold">‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label fw-medium">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô <span class="text-danger">*</span></label>
                        <div class="input-group">
                            <input type="number" name="remainingClasses" class="form-control"
                                   value="8" min="0" required>
                            <span class="input-group-text">‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
                        </div>
                        <small class="text-muted">
                            <i class="fas fa-info-circle"></i> ‡∏õ‡∏Å‡∏ï‡∏¥ 1 ‡∏Ñ‡∏≠‡∏£‡πå‡∏™ = 8 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á (3,000 ‡∏ö‡∏≤‡∏ó)
                        </small>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å -->
            <div class="d-flex gap-2 mt-4">
                <button type="submit" class="btn btn-{{ 'warning' if student else 'success' }}">
                    <i class="fas fa-save"></i> {{ '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç' if student else '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•' }}
                </button>
                <a href="{{ url_for('student_detail', student_id=student.id) if student else url_for('index') }}"
                   class="btn btn-secondary">
                    <i class="fas fa-times"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                </a>
            </div>
        </div>

        <!-- ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ -->
        <div class="col-12 col-lg-4">
            <div class="card bg-light border-0">
                <div class="card-body">
                    <h5 class="card-title fw-semibold">
                        <i class="fas fa-lightbulb text-warning"></i> ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
                    </h5>
                    <ul class="ps-3 mb-0">
                        <li class="mb-2">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ <span class="text-danger">*</span></li>
                        <li class="mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ</li>
                        <li class="mb-2">‡∏Ñ‡∏ß‡∏£‡∏Å‡∏£‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏û‡πâ‡∏¢‡∏≤‡πÉ‡∏´‡πâ‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</li>
                        {% if not student %}
                        <li>1 ‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô = 8 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</li>
                        {% endif %}
                    </ul>
                </div>
            </div>

            {% if student %}
            <!-- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç -->
            <div class="card bg-info bg-opacity-10 border-0 mt-3">
                <div class="card-body">
                    <h6 class="fw-semibold text-info">
                        <i class="fas fa-history"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö
                    </h6>
                    <small class="text-muted">
                        <p class="mb-1">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: {{ student.createdAt|thai_datetime if student.createdAt else '-' }}</p>
                        <p class="mb-0">ID: {{ student.id }}</p>
                    </small>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</form>
{% endblock %}