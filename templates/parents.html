{% extends "base.html" %}

{% block title %}‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á - Basketball Academy{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0 d-flex align-items-center gap-2">
        <i class="fas fa-users text-primary"></i>
        <span>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</span>
    </h1>
    <a href="{{ url_for('add_parent') }}" class="btn btn-primary">
        <i class="fas fa-plus"></i>
        <span class="d-none d-sm-inline">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</span>
    </a>
</div>

<!-- Search Section -->
<div class="card mb-4">
    <div class="card-body">
        <div class="row g-3">
            <div class="col-12 col-md-8">
                <div class="input-group">
                    <span class="input-group-text bg-light border-end-0">
                        <i class="fas fa-search text-muted"></i>
                    </span>
                    <input type="text"
                           id="parentSearchInput"
                           class="form-control border-start-0 ps-0"
                           placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå..."
                           onkeyup="filterParents()">
                </div>
            </div>
            <div class="col-12 col-md-4">
                <button class="btn btn-outline-secondary w-100" onclick="clearParentFilters()">
                    <i class="fas fa-times"></i> ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á -->
<div class="card">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0" id="parentsTable">
                <thead>
                    <tr>
                        <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                        <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</th>
                        <th>‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</th>
                        <th>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</th>
                        <th class="d-none d-md-table-cell">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</th>
                        <th>‡∏ö‡∏∏‡∏ï‡∏£‡∏´‡∏•‡∏≤‡∏ô</th>
                        <th class="text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody>
                    {% for parent in parents %}
                    <tr class="parent-row"
                        data-parent-name="{{ parent.name.lower() }}"
                        data-parent-phone="{{ parent.phone }}">
                        <td>
                            {% if parent.type == 'father' %}
                                <span class="badge bg-primary">üë® ‡∏û‡πà‡∏≠</span>
                            {% else %}
                                <span class="badge bg-primary">üë© ‡πÅ‡∏°‡πà</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="d-flex align-items-center gap-2">
                                <span class="fw-medium">{{ parent.name }}</span>
                            </div>
                        </td>
                        <td>{{ parent.occupation or '-' }}</td>
                        <td>
                            <a href="tel:{{ parent.phone }}" class="text-decoration-none text-muted">
                                <i class="fas fa-phone-alt text-success me-1"></i>
                                {{ parent.phone }}
                            </a>
                        </td>
                        <td class="d-none d-md-table-cell">
                            <small>{{ parent.address or '-' }}</small>
                        </td>
                        <td>
                            {% if parent.students_count > 0 %}
                                <span class="badge bg-primary">{{ parent.students_count }} ‡∏Ñ‡∏ô</span>
                            {% else %}
                                <span class="badge bg-secondary">0 ‡∏Ñ‡∏ô</span>
                            {% endif %}
                        </td>
                        <td class="text-center">
                            <div class="btn-group" role="group">
                                <a href="{{ url_for('edit_parent', parent_id=parent.id) }}"
                                   class="btn btn-sm btn-outline-primary px-2 py-1" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <form method="POST" action="{{ url_for('delete_parent', parent_id=parent.id) }}"
                                      class="d-inline"
                                      onsubmit="return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á {{ parent.name }}?\n\n‚ö†Ô∏è ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡∏Å‡∏≠‡∏¢‡∏π‡πà')">
                                    <button type="submit" class="btn btn-sm btn-outline-danger px-2 py-1" title="‡∏•‡∏ö">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr id="emptyRow">
                        <td colspan="7" class="text-center py-5">
                            <div class="text-muted">
                                <i class="fas fa-users fa-3x mb-3 d-block opacity-25"></i>
                                <p class="mb-0">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</p>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Results Counter -->
        <div class="px-3 py-2 bg-light border-top" id="parentResultsCounter" style="display: none;">
            <small class="text-muted">
                ‡πÅ‡∏™‡∏î‡∏á <span id="parentVisibleCount">0</span> ‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <span id="parentTotalCount">{{ parents|length }}</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            </small>
        </div>
    </div>
</div>

<script>
// Custom button styles
const style = document.createElement('style');
style.textContent = `
    /* Compact button group */
    .btn-group {
        gap: 2px;
    }

    /* Small buttons with icon only */
    .btn-sm.px-2 {
        width: 32px;
        height: 32px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0 !important;
        font-size: 0.875rem;
    }

    /* Remove extra spacing */
    .btn-group form {
        margin: 0;
    }

    /* Hover effects */
    .btn-outline-primary:hover {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
    }

    /* Smaller icons */
    .btn-sm i {
        font-size: 0.875rem;
    }

    /* Table cell padding adjustment */
    td:last-child {
        padding: 0.5rem !important;
    }
`;
document.head.appendChild(style);

// Override any remaining blue colors on page load
document.addEventListener('DOMContentLoaded', function() {
    // Fix badge colors
    document.querySelectorAll('.badge').forEach(badge => {
        if (badge.classList.contains('bg-primary') || badge.classList.contains('bg-info')) {
            badge.style.backgroundColor = '#ff6b35';
        }
    });

    // Fix button colors
    document.querySelectorAll('.btn-primary, .btn-outline-primary').forEach(btn => {
        if (btn.classList.contains('btn-primary')) {
            btn.style.backgroundColor = '#ff6b35';
            btn.style.borderColor = '#ff6b35';
        }
    });
});

function filterParents() {
    const searchText = document.getElementById('parentSearchInput').value.toLowerCase();
    const rows = document.querySelectorAll('.parent-row');
    let visibleCount = 0;

    rows.forEach(row => {
        const parentName = row.dataset.parentName;
        const parentPhone = row.dataset.parentPhone;

        // Text search
        const matchesSearch = searchText === '' ||
                            parentName.includes(searchText) ||
                            parentPhone.includes(searchText);

        if (matchesSearch) {
            row.style.display = '';
            visibleCount++;
        } else {
            row.style.display = 'none';
        }
    });

    // Update counter
    const counter = document.getElementById('parentResultsCounter');
    const visibleSpan = document.getElementById('parentVisibleCount');

    if (searchText) {
        counter.style.display = 'block';
        visibleSpan.textContent = visibleCount;
    } else {
        counter.style.display = 'none';
    }

    // Show no results message
    const tbody = document.querySelector('#parentsTable tbody');
    let noResultsRow = document.getElementById('parentNoResultsRow');
    const emptyRow = document.getElementById('emptyRow');

    if (visibleCount === 0 && rows.length > 0) {
        if (emptyRow) emptyRow.style.display = 'none';

        if (!noResultsRow) {
            noResultsRow = document.createElement('tr');
            noResultsRow.id = 'parentNoResultsRow';
            noResultsRow.innerHTML = `
                <td colspan="7" class="text-center py-4 text-muted">
                    <i class="fas fa-search fa-2x mb-2 d-block opacity-50"></i>
                    ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                </td>
            `;
            tbody.appendChild(noResultsRow);
        }
        noResultsRow.style.display = '';
    } else if (noResultsRow) {
        noResultsRow.style.display = 'none';
        if (emptyRow && rows.length === 0) emptyRow.style.display = '';
    }
}

function clearParentFilters() {
    document.getElementById('parentSearchInput').value = '';
    filterParents();
}

// Auto-focus search on page load
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('parentSearchInput');
    if (searchInput) {
        searchInput.focus();
    }
});

// Search on Enter key
document.getElementById('parentSearchInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        e.preventDefault();
        filterParents();
    }
});
</script>
{% endblock %}